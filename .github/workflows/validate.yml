name: Validate Manifests

on: [push]

jobs:
  Validate-qa-fluxcd:
    name: Validate Qa Fluxcd Manifests
    runs-on: ubuntu-18.04
    container: fluxcd/flux:1.21.0
    steps:
    - uses: actions/checkout@v2
    - name: Get git submodules
      run: git submodule init && git submodule update
      working-directory: qa
    - name: Kustomize Build
      run: kustomize build .
      working-directory: qa/fluxcd
  Validate-qa-apps:
    name: Validate Qa App Manifests
    runs-on: ubuntu-18.04
    container: fluxcd/flux:1.21.0
    strategy:
      matrix:
        app: [arranger, certificate, elasticsearch, ferload, fhir-console, fhir-server, fluentd, frontend, git-autosync, hive-metastore, keycloak, notebook, proxy-api, spark-core, spark-sql, terraform]
    steps:
    - uses: actions/checkout@v2
    - name: Get git submodules
      run: git submodule init && git submodule update
      working-directory: qa
    - name: Kustomize Build
      run: kustomize build .
      working-directory: qa/apps/${{ matrix.app }}
  Validate-stating:
    name: Validate Staging Manifests
    runs-on: ubuntu-18.04
    container: fluxcd/flux:1.21.0
    steps:
    - uses: actions/checkout@v2
    - name: Get git submodules
      run: git submodule init && git submodule update
      working-directory: staging
    - name: Kustomize Build
      run: kustomize build .
      working-directory: staging